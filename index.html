<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informatika | Assalafiyyah Online</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #34495e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--secondary);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo h1 {
            font-size: 1.5rem;
            margin-left: 10px;
        }
        
        .logo-icon {
            font-size: 2rem;
            color: var(--primary);
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 20px;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        nav ul li a:hover {
            color: var(--primary);
        }
        
        .login-container, .dashboard, .exam-container, .result-container, .upload-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
            margin-top: 30px;
        }
        
        h2 {
            color: var(--secondary);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--light);
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        input[type="text"], input[type="password"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .btn-secondary {
            background-color: var(--secondary);
        }
        
        .btn-secondary:hover {
            background-color: #1a252f;
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-danger {
            background-color: var(--danger);
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-warning {
            background-color: var(--warning);
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
        }
        
        .hidden {
            display: none;
        }
        
        .exam-info {
            background-color: var(--light);
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .question {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .question-number {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .option:hover {
            background-color: #f0f0f0;
        }
        
        .option.selected {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        
        .timer {
            position: fixed;
            top: 80px;
            right: 20px;
            background-color: var(--warning);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .result-summary {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .score {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary);
            margin: 20px 0;
        }
        
        .exam-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .exam-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            transition: transform 0.3s;
        }
        
        .exam-card:hover {
            transform: translateY(-5px);
        }
        
        .exam-card h3 {
            color: var(--secondary);
            margin-bottom: 10px;
        }
        
        .exam-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #666;
        }
        
        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 20px;
            transition: border-color 0.3s;
            cursor: pointer;
        }
        
        .upload-area:hover, .upload-area.dragover {
            border-color: var(--primary);
        }
        
        .upload-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .pdf-preview {
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .page-preview {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 4px;
        }
        
        .page-number {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--secondary);
        }
        
        .page-content {
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .question-extraction {
            margin-top: 20px;
        }
        
        .extracted-question {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        
        .extracted-question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .question-actions {
            display: flex;
            gap: 10px;
        }
        
        footer {
            background-color: var(--secondary);
            color: white;
            text-align: center;
            padding: 20px 0;
            margin-top: 50px;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            nav ul {
                margin-top: 15px;
                justify-content: center;
            }
            
            nav ul li {
                margin: 0 10px;
            }
            
            .exam-list {
                grid-template-columns: 1fr;
            }
            
            .question-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">
                <span class="logo-icon">ðŸ’»</span>
                <h1>Ujian Informatika</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="#" id="nav-home">Beranda</a></li>
                    <li><a href="#" id="nav-login">Login</a></li>
                    <li><a href="#" id="nav-dashboard">Dashboard</a></li>
                    <li><a href="#" id="nav-upload">Import Soal</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        <!-- Halaman Login -->
        <div id="login-page" class="login-container">
            <h2>Login</h2>
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Masukkan username">
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Masukkan password">
            </div>
            <div class="form-group">
                <label for="user-type">Tipe Pengguna</label>
                <select id="user-type">
                    <option value="student">Siswa</option>
                    <option value="teacher">Guru</option>
                </select>
            </div>
            <button id="login-btn">Login</button>
            <p style="margin-top: 15px; font-size: 0.9rem;">
                Guru Pengampu: <strong>Bpk. Setiawan Eko Nugroho, S.Kom</strong>
            </p>
        </div>

        <!-- Dashboard Siswa -->
        <div id="dashboard-page" class="dashboard hidden">
            <h2>Dashboard Siswa</h2>
            <p>Selamat datang, <span id="student-name">Siswa</span>!</p>
            
            <div class="exam-list">
                <!-- Daftar ujian akan di-generate oleh JavaScript -->
            </div>
        </div>

        <!-- Dashboard Guru -->
        <div id="teacher-dashboard-page" class="dashboard hidden">
            <h2>Dashboard Guru</h2>
            <p>Selamat datang, <span id="teacher-name">Guru</span>!</p>
            
            <div style="margin-top: 20px;">
                <button id="create-exam-btn" class="btn-success">Buat Ujian Baru</button>
                <button id="import-questions-btn" class="btn-warning">Import Soal</button>
            </div>
            
            <div class="exam-list" id="teacher-exam-list">
                <!-- Daftar ujian guru akan di-generate oleh JavaScript -->
            </div>
        </div>

        <!-- Halaman Upload PDF -->
        <div id="upload-page" class="upload-container hidden">
            <h2>Import Soal dari PDF</h2>
            
            <div class="form-group">
                <label for="exam-name">Nama Ujian</label>
                <input type="text" id="exam-name" placeholder="Masukkan nama ujian">
            </div>
            
            <div class="form-group">
                <label for="exam-duration">Durasi Ujian (menit)</label>
                <input type="number" id="exam-duration" placeholder="Masukkan durasi ujian" min="1">
            </div>
            
            <div class="upload-area" id="upload-area">
                <div class="upload-icon">ðŸ“„</div>
                <h3>Seret file PDF ke sini atau klik untuk memilih</h3>
                <p>Format PDF yang didukung: soal pilihan ganda dengan format yang terstruktur</p>
                <input type="file" id="pdf-file" accept=".pdf" style="display: none;">
            </div>
            
            <div id="pdf-preview" class="pdf-preview hidden">
                <h3>Pratinjau PDF</h3>
                <div id="pdf-pages">
                    <!-- Halaman PDF akan di-generate oleh JavaScript -->
                </div>
            </div>
            
            <div id="question-extraction" class="question-extraction hidden">
                <h3>Ekstraksi Soal</h3>
                <p>Tinjau dan edit soal yang telah diekstrak sebelum menyimpan:</p>
                <div id="extracted-questions">
                    <!-- Soal yang diekstrak akan di-generate oleh JavaScript -->
                </div>
                <div style="margin-top: 20px;">
                    <button id="save-exam-btn" class="btn-success">Simpan Ujian</button>
                </div>
            </div>
        </div>

        <!-- Halaman Ujian -->
        <div id="exam-page" class="exam-container hidden">
            <h2 id="exam-title">Ujian</h2>
            <div class="exam-info">
                <p><strong>Petunjuk:</strong> Pilih jawaban yang paling tepat untuk setiap pertanyaan. Waktu ujian akan ditampilkan di pojok kanan atas.</p>
                <p><strong>Perhatian:</strong> Anda tidak dapat kembali ke pertanyaan sebelumnya setelah melanjutkan.</p>
            </div>
            
            <div id="timer" class="timer hidden">00:00</div>
            
            <div id="questions-container">
                <!-- Pertanyaan akan di-generate oleh JavaScript -->
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button id="prev-question" class="btn-secondary">Sebelumnya</button>
                <button id="next-question" class="btn-success">Selanjutnya</button>
                <button id="submit-exam" class="btn-danger hidden">Selesai & Kirim Jawaban</button>
            </div>
        </div>

        <!-- Halaman Hasil -->
        <div id="result-page" class="result-container hidden">
            <h2>Hasil Ujian</h2>
            <div class="result-summary">
                <p>Ujian: <span id="result-exam-title">Ujian</span></p>
                <div class="score" id="final-score">0</div>
                <p id="result-message">Pesan hasil akan ditampilkan di sini</p>
            </div>
            
            <div id="result-details">
                <!-- Detail hasil akan di-generate oleh JavaScript -->
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button id="back-to-dashboard" class="btn-secondary">Kembali ke Dashboard</button>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>Website Ujian Informatika &copy; 2025 - Assalafiyyah Mlangi</p>
        </div>
    </footer>

    <script>
        // Konfigurasi PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';

        // Data ujian
        let exams = JSON.parse(localStorage.getItem('exams')) || {
            1: {
                id: 1,
                title: "Ujian Pemrograman Dasar",
                duration: 60,
                teacher: "Bpk. Setiawan Eko Nugroho, S.Kom",
                questions: [
                    {
                        id: 1,
                        text: "Apa yang dimaksud dengan variabel dalam pemrograman?",
                        options: [
                            "Tempat penyimpanan data",
                            "Jenis data",
                            "Fungsi matematika",
                            "Struktur kontrol"
                        ],
                        correct: 0
                    },
                    {
                        id: 2,
                        text: "Manakah yang bukan termasuk tipe data primitif di JavaScript?",
                        options: [
                            "String",
                            "Number",
                            "Boolean",
                            "Array"
                        ],
                        correct: 3
                    }
                ]
            },
            2: {
                id: 2,
                title: "Ujian Struktur Data",
                duration: 45,
                teacher: "Bpk. Setiawan Eko Nugroho, S.Kom",
                questions: [
                    {
                        id: 1,
                        text: "Struktur data yang mengikuti prinsip LIFO adalah?",
                        options: [
                            "Queue",
                            "Stack",
                            "Linked List",
                            "Tree"
                        ],
                        correct: 1
                    }
                ]
            }
        };

        // State aplikasi
        let currentUser = null;
        let currentExam = null;
        let currentQuestionIndex = 0;
        let userAnswers = {};
        let timerInterval = null;
        let timeLeft = 0;
        let currentPdf = null;
        let extractedQuestions = [];

        // Elemen DOM
        const loginPage = document.getElementById('login-page');
        const dashboardPage = document.getElementById('dashboard-page');
        const teacherDashboardPage = document.getElementById('teacher-dashboard-page');
        const uploadPage = document.getElementById('upload-page');
        const examPage = document.getElementById('exam-page');
        const resultPage = document.getElementById('result-page');
        
        const loginBtn = document.getElementById('login-btn');
        const studentName = document.getElementById('student-name');
        const teacherName = document.getElementById('teacher-name');
        const createExamBtn = document.getElementById('create-exam-btn');
        const importQuestionsBtn = document.getElementById('import-questions-btn');
        const prevQuestionBtn = document.getElementById('prev-question');
        const nextQuestionBtn = document.getElementById('next-question');
        const submitExamBtn = document.getElementById('submit-exam');
        const backToDashboardBtn = document.getElementById('back-to-dashboard');
        const uploadArea = document.getElementById('upload-area');
        const pdfFileInput = document.getElementById('pdf-file');
        const pdfPreview = document.getElementById('pdf-preview');
        const pdfPages = document.getElementById('pdf-pages');
        const questionExtraction = document.getElementById('question-extraction');
        const extractedQuestionsContainer = document.getElementById('extracted-questions');
        const saveExamBtn = document.getElementById('save-exam-btn');
        
        const examTitle = document.getElementById('exam-title');
        const questionsContainer = document.getElementById('questions-container');
        const timer = document.getElementById('timer');
        
        const resultExamTitle = document.getElementById('result-exam-title');
        const finalScore = document.getElementById('final-score');
        const resultMessage = document.getElementById('result-message');
        const resultDetails = document.getElementById('result-details');

        // Navigasi
        document.getElementById('nav-home').addEventListener('click', () => {
            showPage(loginPage);
        });
        
        document.getElementById('nav-login').addEventListener('click', () => {
            showPage(loginPage);
        });
        
        document.getElementById('nav-dashboard').addEventListener('click', () => {
            if (currentUser) {
                if (currentUser.type === 'teacher') {
                    showPage(teacherDashboardPage);
                } else {
                    showPage(dashboardPage);
                }
            } else {
                showPage(loginPage);
            }
        });
        
        document.getElementById('nav-upload').addEventListener('click', () => {
            if (currentUser && currentUser.type === 'teacher') {
                showPage(uploadPage);
            } else {
                showPage(loginPage);
            }
        });

        // Fungsi untuk menampilkan halaman tertentu
        function showPage(page) {
            loginPage.classList.add('hidden');
            dashboardPage.classList.add('hidden');
            teacherDashboardPage.classList.add('hidden');
            uploadPage.classList.add('hidden');
            examPage.classList.add('hidden');
            resultPage.classList.add('hidden');
            
            page.classList.remove('hidden');
            
            // Jika menampilkan dashboard, refresh daftar ujian
            if (page === dashboardPage) {
                refreshStudentExamList();
            } else if (page === teacherDashboardPage) {
                refreshTeacherExamList();
            }
        }

        // Login
        loginBtn.addEventListener('click', () => {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const userType = document.getElementById('user-type').value;
            
            if (username && password) {
                // Simulasi login berhasil
                currentUser = {
                    name: username,
                    id: Math.floor(Math.random() * 1000),
                    type: userType
                };
                
                studentName.textContent = currentUser.name;
                teacherName.textContent = currentUser.name;
                
                if (userType === 'teacher') {
                    showPage(teacherDashboardPage);
                } else {
                    showPage(dashboardPage);
                }
                
                // Reset form login
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
            } else {
                alert('Silakan masukkan username dan password!');
            }
        });

        // Upload PDF
        uploadArea.addEventListener('click', () => {
            pdfFileInput.click();
        });

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            if (e.dataTransfer.files.length > 0) {
                const file = e.dataTransfer.files[0];
                if (file.type === 'application/pdf') {
                    handlePdfUpload(file);
                } else {
                    alert('Hanya file PDF yang diizinkan!');
                }
            }
        });

        pdfFileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                handlePdfUpload(file);
            }
        });

        // Fungsi untuk menangani upload PDF
        async function handlePdfUpload(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                currentPdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                
                // Tampilkan preview PDF
                pdfPreview.classList.remove('hidden');
                pdfPages.innerHTML = '';
                
                // Render setiap halaman
                for (let i = 1; i <= currentPdf.numPages; i++) {
                    const page = await currentPdf.getPage(i);
                    const viewport = page.getViewport({ scale: 1.5 });
                    
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    
                    await page.render({
                        canvasContext: context,
                        viewport: viewport
                    }).promise;
                    
                    const pageDiv = document.createElement('div');
                    pageDiv.className = 'page-preview';
                    
                    const pageNumber = document.createElement('div');
                    pageNumber.className = 'page-number';
                    pageNumber.textContent = `Halaman ${i}`;
                    
                    const pageContent = document.createElement('div');
                    pageContent.className = 'page-content';
                    
                    // Ekstrak teks dari halaman
                    const textContent = await page.getTextContent();
                    const textItems = textContent.items.map(item => item.str).join(' ');
                    pageContent.textContent = textItems.substring(0, 300) + '...';
                    
                    pageDiv.appendChild(pageNumber);
                    pageDiv.appendChild(pageContent);
                    pdfPages.appendChild(pageDiv);
                    
                    // Simpan teks untuk ekstraksi soal
                    if (i === 1) {
                        extractQuestionsFromText(textItems);
                    }
                }
                
                // Tampilkan ekstraksi soal
                questionExtraction.classList.remove('hidden');
                displayExtractedQuestions();
                
            } catch (error) {
                console.error('Error loading PDF:', error);
                alert('Terjadi kesalahan saat memuat PDF. Pastikan file PDF valid.');
            }
        }

        // Fungsi untuk mengekstrak soal dari teks PDF
        function extractQuestionsFromText(text) {
            extractedQuestions = [];
            
            // Contoh sederhana: mencari pola nomor soal
            const questionRegex = /\d+\.\s*(.*?)(?=\d+\.|$)/gs;
            let match;
            
            while ((match = questionRegex.exec(text)) !== null) {
                const questionText = match[1].trim();
                
                // Cari opsi jawaban (A, B, C, D)
                const optionRegex = /([A-D])\.\s*(.*?)(?=[A-D]\.|$)/gs;
                const options = [];
                let optionMatch;
                
                while ((optionMatch = optionRegex.exec(questionText)) !== null) {
                    options.push(optionMatch[2].trim());
                }
                
                if (options.length >= 2) {
                    extractedQuestions.push({
                        id: extractedQuestions.length + 1,
                        text: questionText.split(/[A-D]\./)[0].trim(),
                        options: options,
                        correct: 0 // Default: jawaban pertama adalah benar
                    });
                }
            }
            
            // Jika tidak ada soal yang ditemukan dengan regex, buat contoh manual
            if (extractedQuestions.length === 0) {
                extractedQuestions = [
                    {
                        id: 1,
                        text: "Apa yang dimaksud dengan algoritma?",
                        options: [
                            "Langkah-langkah untuk menyelesaikan masalah",
                            "Bahasa pemrograman",
                            "Struktur data",
                            "Jenis variabel"
                        ],
                        correct: 0
                    },
                    {
                        id: 2,
                        text: "Manakah yang termasuk struktur data linear?",
                        options: [
                            "Array",
                            "Tree",
                            "Graph",
                            "Hash Table"
                        ],
                        correct: 0
                    }
                ];
            }
        }

        // Fungsi untuk menampilkan soal yang diekstrak
        function displayExtractedQuestions() {
            extractedQuestionsContainer.innerHTML = '';
            
            extractedQuestions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'extracted-question';
                
                const headerDiv = document.createElement('div');
                headerDiv.className = 'extracted-question-header';
                
                const questionNumber = document.createElement('h4');
                questionNumber.textContent = `Soal ${index + 1}`;
                
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'question-actions';
                
                const editBtn = document.createElement('button');
                editBtn.textContent = 'Edit';
                editBtn.className = 'btn-secondary';
                editBtn.addEventListener('click', () => editQuestion(index));
                
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Hapus';
                deleteBtn.className = 'btn-danger';
                deleteBtn.addEventListener('click', () => deleteQuestion(index));
                
                actionsDiv.appendChild(editBtn);
                actionsDiv.appendChild(deleteBtn);
                
                headerDiv.appendChild(questionNumber);
                headerDiv.appendChild(actionsDiv);
                
                const questionText = document.createElement('div');
                questionText.innerHTML = `<strong>Pertanyaan:</strong> ${question.text}`;
                
                const optionsList = document.createElement('div');
                optionsList.innerHTML = '<strong>Opsi:</strong>';
                
                const optionsUl = document.createElement('ul');
                question.options.forEach((option, optIndex) => {
                    const li = document.createElement('li');
                    li.textContent = `${String.fromCharCode(65 + optIndex)}. ${option}`;
                    if (optIndex === question.correct) {
                        li.style.fontWeight = 'bold';
                        li.style.color = 'var(--success)';
                    }
                    optionsUl.appendChild(li);
                });
                
                optionsList.appendChild(optionsUl);
                
                questionDiv.appendChild(headerDiv);
                questionDiv.appendChild(questionText);
                questionDiv.appendChild(optionsList);
                
                extractedQuestionsContainer.appendChild(questionDiv);
            });
        }

        // Fungsi untuk mengedit soal
        function editQuestion(index) {
            const question = extractedQuestions[index];
            
            const newText = prompt('Edit pertanyaan:', question.text);
            if (newText !== null) {
                question.text = newText;
            }
            
            let newOptions = '';
            question.options.forEach((option, i) => {
                newOptions += `${String.fromCharCode(65 + i)}. ${option}\n`;
            });
            
            const editedOptions = prompt('Edit opsi (satu opsi per baris):', newOptions);
            if (editedOptions !== null) {
                const optionsArray = editedOptions.split('\n').filter(opt => opt.trim() !== '');
                question.options = optionsArray.map(opt => {
                    // Hapus label A. B. C. D. jika ada
                    return opt.replace(/^[A-D]\.\s*/, '').trim();
                });
            }
            
            const correctAnswer = prompt('Masukkan huruf jawaban benar (A, B, C, atau D):', String.fromCharCode(65 + question.correct));
            if (correctAnswer !== null) {
                const correctIndex = correctAnswer.toUpperCase().charCodeAt(0) - 65;
                if (correctIndex >= 0 && correctIndex < question.options.length) {
                    question.correct = correctIndex;
                }
            }
            
            displayExtractedQuestions();
        }

        // Fungsi untuk menghapus soal
        function deleteQuestion(index) {
            if (confirm('Apakah Anda yakin ingin menghapus soal ini?')) {
                extractedQuestions.splice(index, 1);
                displayExtractedQuestions();
            }
        }

        // Simpan ujian
        saveExamBtn.addEventListener('click', () => {
            const examName = document.getElementById('exam-name').value;
            const examDuration = document.getElementById('exam-duration').value;
            
            if (!examName || !examDuration) {
                alert('Harap isi nama ujian dan durasi!');
                return;
            }
            
            if (extractedQuestions.length === 0) {
                alert('Tidak ada soal yang akan disimpan!');
                return;
            }
            
            // Buat ID unik untuk ujian baru
            const examId = Date.now();
            
            // Simpan ujian
            exams[examId] = {
                id: examId,
                title: examName,
                duration: parseInt(examDuration),
                teacher: currentUser.name,
                questions: [...extractedQuestions]
            };
            
            // Simpan ke localStorage
            localStorage.setItem('exams', JSON.stringify(exams));
            
            alert('Ujian berhasil disimpan!');
            showPage(teacherDashboardPage);
        });

        // Refresh daftar ujian untuk siswa
        function refreshStudentExamList() {
            const examList = document.querySelector('.exam-list');
            examList.innerHTML = '';
            
            Object.values(exams).forEach(exam => {
                const examCard = document.createElement('div');
                examCard.className = 'exam-card';
                
                examCard.innerHTML = `
                    <h3>${exam.title}</h3>
                    <p>Guru: ${exam.teacher}</p>
                    <div class="exam-meta">
                        <span>Waktu: ${exam.duration} menit</span>
                        <span>${exam.questions.length} Soal</span>
                    </div>
                    <button class="btn-start-exam" data-exam="${exam.id}">Mulai Ujian</button>
                `;
                
                examList.appendChild(examCard);
            });
            
            // Tambahkan event listener untuk tombol mulai ujian
            document.querySelectorAll('.btn-start-exam').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const examId = e.target.getAttribute('data-exam');
                    startExam(examId);
                });
            });
        }

        // Refresh daftar ujian untuk guru
        function refreshTeacherExamList() {
            const teacherExamList = document.getElementById('teacher-exam-list');
            teacherExamList.innerHTML = '';
            
            Object.values(exams).forEach(exam => {
                const examCard = document.createElement('div');
                examCard.className = 'exam-card';
                
                examCard.innerHTML = `
                    <h3>${exam.title}</h3>
                    <p>Durasi: ${exam.duration} menit</p>
                    <div class="exam-meta">
                        <span>${exam.questions.length} Soal</span>
                        <span>Dibuat oleh: ${exam.teacher}</span>
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn-edit-exam" data-exam="${exam.id}">Edit</button>
                        <button class="btn-delete-exam" data-exam="${exam.id}">Hapus</button>
                    </div>
                `;
                
                teacherExamList.appendChild(examCard);
            });
            
            // Tambahkan event listener untuk tombol edit dan hapus
            document.querySelectorAll('.btn-edit-exam').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const examId = e.target.getAttribute('data-exam');
                    editExam(examId);
                });
            });
            
            document.querySelectorAll('.btn-delete-exam').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const examId = e.target.getAttribute('data-exam');
                    deleteExam(examId);
                });
            });
        }

        // Mulai ujian
        function startExam(examId) {
            currentExam = exams[examId];
            currentQuestionIndex = 0;
            userAnswers = {};
            
            // Set timer
            timeLeft = currentExam.duration * 60; // konversi ke detik
            updateTimerDisplay();
            timer.classList.remove('hidden');
            
            // Mulai timer
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    finishExam();
                }
            }, 1000);
            
            // Tampilkan halaman ujian
            examTitle.textContent = currentExam.title;
            showPage(examPage);
            
            // Tampilkan pertanyaan pertama
            displayQuestion();
        }

        // Update tampilan timer
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Ubah warna jika waktu hampir habis
            if (timeLeft < 300) { // 5 menit
                timer.style.backgroundColor = 'var(--danger)';
            }
        }

        // Tampilkan pertanyaan
        function displayQuestion() {
            const question = currentExam.questions[currentQuestionIndex];
            
            let html = `
                <div class="question">
                    <div class="question-number">Pertanyaan ${currentQuestionIndex + 1} dari ${currentExam.questions.length}</div>
                    <div class="question-text">${question.text}</div>
                    <div class="options">
            `;
            
            question.options.forEach((option, index) => {
                const isChecked = userAnswers[question.id] === index ? 'checked' : '';
                html += `
                    <div class="option">
                        <input type="radio" id="q${question.id}_opt${index}" name="q${question.id}" value="${index}" ${isChecked}>
                        <label for="q${question.id}_opt${index}">${String.fromCharCode(65 + index)}. ${option}</label>
                    </div>
                `;
            });
            
            html += `</div></div>`;
            
            questionsContainer.innerHTML = html;
            
            // Tambahkan event listener untuk opsi
            question.options.forEach((option, index) => {
                document.getElementById(`q${question.id}_opt${index}`).addEventListener('change', (e) => {
                    userAnswers[question.id] = parseInt(e.target.value);
                });
            });
            
            // Tampilkan/tutup tombol navigasi
            prevQuestionBtn.style.display = currentQuestionIndex > 0 ? 'inline-block' : 'none';
            nextQuestionBtn.style.display = currentQuestionIndex < currentExam.questions.length - 1 ? 'inline-block' : 'none';
            submitExamBtn.classList.toggle('hidden', currentQuestionIndex < currentExam.questions.length - 1);
        }

        // Navigasi pertanyaan
        prevQuestionBtn.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        });

        nextQuestionBtn.addEventListener('click', () => {
            if (currentQuestionIndex < currentExam.questions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            }
        });

        // Selesai ujian
        submitExamBtn.addEventListener('click', () => {
            if (confirm('Apakah Anda yakin ingin menyelesaikan ujian?')) {
                finishExam();
            }
        });

        // Fungsi untuk menyelesaikan ujian
        function finishExam() {
            clearInterval(timerInterval);
            
            // Hitung skor
            let score = 0;
            let correctAnswers = 0;
            
            currentExam.questions.forEach(question => {
                if (userAnswers[question.id] === question.correct) {
                    correctAnswers++;
                }
            });
            
            score = Math.round((correctAnswers / currentExam.questions.length) * 100);
            
            // Tampilkan hasil
            resultExamTitle.textContent = currentExam.title;
            finalScore.textContent = score;
            
            // Tentukan pesan hasil
            if (score >= 80) {
                resultMessage.textContent = "Selamat! Anda lulus dengan nilai yang sangat baik.";
                resultMessage.style.color = "var(--success)";
            } else if (score >= 60) {
                resultMessage.textContent = "Anda lulus ujian. Pertahankan!";
                resultMessage.style.color = "var(--warning)";
            } else {
                resultMessage.textContent = "Maaf, Anda belum lulus. Silakan coba lagi.";
                resultMessage.style.color = "var(--danger)";
            }
            
            // Tampilkan detail hasil
            let detailsHtml = "<h3>Detail Jawaban:</h3>";
            currentExam.questions.forEach((question, index) => {
                const userAnswer = userAnswers[question.id];
                const isCorrect = userAnswer === question.correct;
                
                detailsHtml += `
                    <div class="question" style="margin-bottom: 15px; padding: 10px; border-radius: 4px; background-color: ${isCorrect ? 'rgba(46, 204, 113, 0.1)' : 'rgba(231, 76, 60, 0.1)'}">
                        <div class="question-number">Pertanyaan ${index + 1}</div>
                        <div class="question-text">${question.text}</div>
                        <div style="margin-top: 10px;">
                            <p><strong>Jawaban Anda:</strong> ${userAnswer !== undefined ? `${String.fromCharCode(65 + userAnswer)}. ${question.options[userAnswer]}` : 'Tidak dijawab'}</p>
                            <p><strong>Jawaban Benar:</strong> ${String.fromCharCode(65 + question.correct)}. ${question.options[question.correct]}</p>
                            <p style="color: ${isCorrect ? 'var(--success)' : 'var(--danger)'}; font-weight: bold;">
                                ${isCorrect ? 'âœ“ Benar' : 'âœ— Salah'}
                            </p>
                        </div>
                    </div>
                `;
            });
            
            resultDetails.innerHTML = detailsHtml;
            
            // Tampilkan halaman hasil
            showPage(resultPage);
        }

        // Kembali ke dashboard
        backToDashboardBtn.addEventListener('click', () => {
            if (currentUser.type === 'teacher') {
                showPage(teacherDashboardPage);
            } else {
                showPage(dashboardPage);
            }
        });

        // Buat ujian baru
        createExamBtn.addEventListener('click', () => {
            // Reset form upload
            document.getElementById('exam-name').value = '';
            document.getElementById('exam-duration').value = '';
            pdfPreview.classList.add('hidden');
            questionExtraction.classList.add('hidden');
            extractedQuestions = [];
            
            showPage(uploadPage);
        });

        // Import soal dari PDF
        importQuestionsBtn.addEventListener('click', () => {
            showPage(uploadPage);
        });

        // Edit ujian
        function editExam(examId) {
            const exam = exams[examId];
            extractedQuestions = [...exam.questions];
            
            // Isi form
            document.getElementById('exam-name').value = exam.title;
            document.getElementById('exam-duration').value = exam.duration;
            
            // Tampilkan ekstraksi soal
            pdfPreview.classList.add('hidden');
            questionExtraction.classList.remove('hidden');
            displayExtractedQuestions();
            
            showPage(uploadPage);
        }

        // Hapus ujian
        function deleteExam(examId) {
            if (confirm('Apakah Anda yakin ingin menghapus ujian ini?')) {
                delete exams[examId];
                localStorage.setItem('exams', JSON.stringify(exams));
                refreshTeacherExamList();
            }
        }

        // Inisialisasi: tampilkan halaman login
        showPage(loginPage);
    </script>
</body>
</html>